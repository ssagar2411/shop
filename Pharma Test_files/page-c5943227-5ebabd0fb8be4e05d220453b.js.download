!function(e){var t=!1;function r(e){for(var t=[],r=0;r<e.length;r++)e[r].checked&&t.push(e[r].value);return t.join(" ||| ")}function n(e,t){return e.required&&"string"==typeof t&&0===t.length?"This field is required!":"email"!==e.type||/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(t).toLowerCase())?"consent"!==e.type&&"concent"!==e.type||t?void 0:"This field is required!":"Please enter your email address in format: yourname@example.com"}function o(o){o.preventDefault();var i=!1;const a=this.querySelector("[type=submit]").children[0],s=function(e){const t=[],o={},i=e.elements,a=JSON.parse(e.getAttribute("data-form-state")),s=a.fields;for(var c=0;c<s.length;c++){var d=s[c],l=void 0;switch(d.type){case"text":case"email":case"radio":case"select":case"textarea":case"hidden":l=i[d.id].value;break;case"checkbox":l=r(i[d.id]);break;case"concent":case"consent":l=i[d.id].checked}o[d.id]={label:d.label,placeholder:d.placeholder,type:d.type,value:l};var u=n(d,l);u&&t.push({$field_set:i[d.id]instanceof HTMLElement?i[d.id].closest("fieldset"):i[d.id][0].closets("fieldset"),message:u})}return{errors:t,values:o,form_data:a}}(this),c=s.form_data;if(function(e){for(var t=e.querySelectorAll(".validation-error"),r=0;r<t.length;r++)t[r].remove()}(this),s.errors.length)return function(e){for(var t=0;t<e.length;t++){var r=document.createElement("span");r.innerHTML=e[t].message,r.className="validation-error",e[t].$field_set.appendChild(r)}}(s.errors),i="Please check your input",void(a.innerText=i);const d={form_id:c.id,deploy_id:e.project_id,project_id:e.project_id,funnel_id:e.funnel_id,page_id:e.page_id,client_id:e.clientId,forward_email:c.forward_email,forward_email_subject:c.forward_email_subject,title:c.form_title,webhook_url:c.webhook_url,redirect_url:c.redirect_url,source:window?window.location.protocol+"//"+window.location.hostname:"",fields:s.values};!0!==t?(t=!0,fetch(e.endpoints.converdy_leads_endpoint,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)}).then(t=>{if(200==t.status){const t=c.redirect_url;i="Success",a.innerText=i,e.events.$emit("ca_event",{event:"form_submitted"});const r=Object.keys(JSON.parse(JSON.stringify(s.values))).reduce(function(e,t){return e[t]=s.values[t].value,e},{});t&&t.length&&(__converdy__.is_preview?window.alert("Redirect is disabled in preview mode"):window.location.href=function(e="",t){try{const r=document.createElement("a");r.href=e;const n=new URL(r.href);Object.keys(t).forEach(e=>{n.searchParams.append(e,t[e])}),e=n.href}catch(o){console.warn("not a valid url, params could not be added")}return e}(t,r))}else i="Error",a.innerText=i}).catch(e=>{i="Error",a.innerText=i,t=!1,console.log(e)})):console.log("is already submitted!")}const i=document.querySelectorAll(".converdy-lead-form");for(let a=0;a<i.length;a++)i[a].addEventListener("submit",o)}(window.__converdy__);